services:
  proxy_manager:
    image: 'jc21/nginx-proxy-manager:latest'
    restart: unless-stopped
    ports:
      - '80:80'     # Port HTTP public
      - '443:443'   # Port HTTPS public
      - '8081:81'     # ← CHANGÉ ICI
    environment:
      DB_POSTGRES_HOST: 'proxy_manager_db'               # Nom d'hôte de la base de données
      DB_POSTGRES_PORT: '5432'              # Port de la base de données
      DB_POSTGRES_USER: 'siseb_proxy_proxy'        # Utilisateur de la base de données
      DB_POSTGRES_PASSWORD: 'sise5@s@prox!'     # Mot de passe de la base de données
      DB_POSTGRES_NAME: 'siseb_proxy_proxy'        # Nom de la base de données
    volumes:
      - ./proxy_data:/data                        # Volume pour les données de l'application
      - ./letsencrypt:/etc/letsencrypt      # Volume pour les certificats Let's Encrypt
    depends_on:
      - proxy_manager_db                                   # Dépend de la base de données
    networks:
      - siseb_proxy                                 # Réseau utilisé

  proxy_manager_db:
    image: postgres:latest
    restart: unless-stopped
    environment:
      POSTGRES_USER: 'siseb_proxy_proxy'           # Utilisateur de la base de données
      POSTGRES_PASSWORD: 'sise5@s@prox!'        # Mot de passe de la base de données
      POSTGRES_DB: 'siseb_proxy_proxy'              # Nom de la base de données
    volumes:
      - ./postgres:/var/lib/postgresql              # Volume pour stocker les données de PostgreSQL
    networks: 
      - siseb_proxy     
      
  web_server_test_1:
    image: php:apache
    volumes:
      - ./web_test/test1:/var/www/html/
    ports:
      - "39080:80"
    networks: 
      - siseb_proxy   

  web_server_test_2:
    image: php:apache
    volumes:
      - ./web_test/test2:/var/www/html/
    ports:
      - "39090:80"   
    networks: 
      - siseb_proxy                  # Réseau utilisé

networks:
  siseb_proxy:
    driver: bridge                 # Réseau utilisé